<!DOCTYPE html>
<html lang="z">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>Rust - 移动端跨平台开发实践 | 跃迁引擎</title>
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="iOS Research &amp; Development">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Rust - 移动端跨平台开发实践 | 跃迁引擎">
    <meta name="twitter:description" content="iOS Research &amp; Development">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Rust - 移动端跨平台开发实践 | 跃迁引擎">
    <meta property="og:description" content="iOS Research &amp; Development">

    
    <meta name="author" content="ShevaKuilin">
    
    
<link rel="stylesheet" href="/css/vno.css">

    
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">


    
    <link rel="icon" href="/images/favicon.png">
    

    <meta name="generator" content="hexo"/>
    

    <link rel="canonical" href="http://shevakuilin.com/rust-mob-client/"/>

                 
</head>

<body class="home-template no-js">
    
<script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>

    
<script src="/js/main.js"></script>

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>

    
<header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background.jpg)">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/" title="前往 跃迁引擎 的主页"><img src="/images/avatar.jpeg" width="80" alt="跃迁引擎 logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage for 跃迁引擎">跃迁引擎</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">空気を読んだ雨降らないでよ</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">iOS Research & Development</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        <div class="navigation-wrapper">
          <div>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="访问博客" class="blog-button">主页</a></li>
            
              <li class="navigation__item"><a href="/archives">所有文章</a></li>
            
              <li class="navigation__item"><a href="/tags/算法/">算法</a></li>
            
              <li class="navigation__item"><a href="/tags/iOS/">iOS</a></li>
            
              <li class="navigation__item"><a href="/tags/AI/">AI</a></li>
            
              <li class="navigation__item"><a href="/tags/HarmonyOS/">HarmonyOS</a></li>
            
              <li class="navigation__item"><a href="/tags/Rust/">Rust</a></li>
            
              <li class="navigation__item"><a href="/tags/札记/">札记</a></li>
            
              <li class="navigation__item"><a href="/tags/随笔/">随笔</a></li>
            
              <li class="navigation__item"><a href="/tags/折腾日记/">折腾日记</a></li>
            
            </ul>
          </nav>
          </div>
          <div>
          <nav class="cover-navigation navigation--social">
  <ul class="navigation">

  <!-- Weibo-->
  

  <!-- Github -->
  
  <li class="navigation__item">
    <a href="https://github.com/shevakuilin" title="查看我的GitHub主页" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>


<!-- Stack Overflow -->
        

  <!-- Google Plus -->
  

<!-- Facebook -->

  
<!-- Twitter -->

  



  </ul>
</nav>

          </div>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-disabled"></div>
  </div> 
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single">

  <header class="post-header">
    <div class="post-meta">
      <time datetime="2024-06-22T06:40:56.000Z" class="post-list__meta--date date">2024-06-22</time> &#8226; <span class="post-meta__tags tags">于 
  <a class="-none-link" href="/tags/Rust/" rel="tag">Rust</a>, <a class="-none-link" href="/tags/%E8%B7%A8%E5%B9%B3%E5%8F%B0/" rel="tag">跨平台</a>
 </span>
      <span class="page-pv">
       阅读 <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>
      </span> 
   
    </div>
    <h1 class="post-title">Rust - 移动端跨平台开发实践</h1>
  </header>

  <section class="post">
    <img src="https://github.com/shevakuilin/GhostPostsImages/raw/master/rust-mob-client.png">

<h2 id="1-整体方案"><a href="#1-整体方案" class="headerlink" title="1. 整体方案"></a>1. <strong>整体方案</strong></h2><p><img src="https://tjny2v67lw.feishu.cn/space/api/box/stream/download/asynccode/?code=NjJiYjFlNGNkNjgyNWUzY2RlYmI1YjI5Mjg2OTI5OThfN0JpY3d1d2NrZHdKNkQxVDN1ZWxuTTlUQ2w2UFlOTHBfVG9rZW46WmdBS2JqZzVXb1hIenR4azlIU2N6TmtyblFiXzE3NDIxOTM2OTE6MTc0MjE5NzI5MV9WNA" alt="img"></p>
<p>Rust的移动端跨平台开发方案，具体如下</p>
<ol>
<li>最底层SDK的业务逻辑由Rust实现</li>
<li>使用ffi工具，编写binding code<ol>
<li>Android、iOS：中间层使用uniffi编写binding代码。使用uniffi-bindgen将binding代码生成kotlin、Swift代码，方便Android、iOS调用。</li>
<li>鸿蒙：使用ohos-rs编写binding代码，使用ohos工具生成har包方便鸿蒙调用</li>
</ol>
</li>
<li>构建工具<ol>
<li>Android: 最终使用ndk build的工具编译Android 平台的so</li>
<li>iOS：未找到比较好用的工具，自行编写脚本构建xcframework</li>
<li>鸿蒙：最终使用ohrs build 构建鸿蒙平台的so</li>
</ol>
</li>
</ol>
<h2 id="2-代码详解"><a href="#2-代码详解" class="headerlink" title="2. 代码详解"></a>2. <strong>代码详解</strong></h2><p>整个工程目录结构如下</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">├── doc</span><br><span class="line">│   └── <span class="selector-tag">image</span></span><br><span class="line">├── harmony</span><br><span class="line">│   ├── dist</span><br><span class="line">│   │   ├── strip</span><br><span class="line">│   │   └── <span class="selector-tag">symbol</span></span><br><span class="line">│   └── <span class="attribute">src</span></span><br><span class="line">└── uniffi</span><br><span class="line">    ├── dist</span><br><span class="line">    │   ├── android</span><br><span class="line">    │   └── ios</span><br><span class="line">    ├── mobile_ffi</span><br><span class="line">    │   └── <span class="attribute">src</span></span><br><span class="line">    └── uniffi-bindgen</span><br><span class="line">        └── <span class="attribute">src</span></span><br></pre></td></tr></table></figure>

<h3 id="2-1-编译环境"><a href="#2-1-编译环境" class="headerlink" title="2.1 编译环境"></a>2.1 编译环境</h3><ul>
<li>Android 安装<a href="https://link.juejin.cn/?target=https://github.com/bbqsrc/cargo-ndk">cargo-ndk</a><code>cargo install cargo-ndk</code></li>
<li>iOS 需要安装  Xcode</li>
<li>鸿蒙 需要安装 <a href="https://link.juejin.cn/?target=https://ohos.rs/docs/basic/quick-start.html">ohrs</a> <code>cargo install ohrs</code></li>
</ul>
<p>该仓库可以作为一个Rust移动端跨平台开发的模版，通过init.py脚本可以快速初始化一个工程。</p>
<h3 id="2-2-uniffi"><a href="#2-2-uniffi" class="headerlink" title="2.2 uniffi"></a>2.2 <strong>uniffi</strong></h3><p><img src="https://tjny2v67lw.feishu.cn/space/api/box/stream/download/asynccode/?code=YzQ4ZjMyY2Q4N2NkMzNhMmFhMzYyZjA4MTk0MTUzYzVfSEtxc2lneGxvekxCbXkyMGVvUGQ5OEQ1RFZlbzhaa09fVG9rZW46Wm12UWJrdnFWb2JTdld4WW1PZWNqTUtXbmlnXzE3NDIxOTM2OTE6MTc0MjE5NzI5MV9WNA" alt="img"></p>
<p>该目录是workspace，包含mobile-ffi、uniffi-bindgen、dist,  build_android_sh,  build_ios_xc.sh </p>
<ul>
<li><strong>mobile-ffi</strong></li>
</ul>
<p> 编写 rust 代码</p>
<ul>
<li><strong>uniffi-bindgen</strong></li>
</ul>
<p>该目录是源码依赖uniffi工具</p>
<ul>
<li><strong>build_android_sh</strong> <ul>
<li>Android编译脚本</li>
</ul>
</li>
<li><strong>build_ios_xc.sh</strong> <ul>
<li>iOS编译脚本</li>
</ul>
</li>
<li><strong>dist</strong></li>
</ul>
<p>该目录下包括Android、iOS的构建产物 </p>
<ul>
<li>Android: 包含生成的kotlin代码、带符号、无符号的so，其中so包含arm64-v8a、armeabi-v7a</li>
<li>iOS：包含生成的swift代码和xcframework，其中xcframework包含ios-arm64、ios-arm64_x86_64-simulator</li>
</ul>
<h3 id="2-3-harmony"><a href="#2-3-harmony" class="headerlink" title="2.3 harmony"></a>2.3 harmony</h3><p>该目录是依赖ohrs的能力，自动生成har包  </p>
<ul>
<li><strong>鸿蒙脚本</strong></li>
</ul>
<p>build_ohos.sh 是构建鸿蒙产物的脚本，运行 sh build_ohos.sh 即可</p>
<ul>
<li><strong>dist</strong></li>
</ul>
<p>该目录下包含鸿蒙平台的构建产物，包含带符号、无符号的so，其中so包含arm64-v8a、armeabi-v7a、x86_64</p>
<h2 id="3-使用姿势"><a href="#3-使用姿势" class="headerlink" title="3. 使用姿势"></a>3. 使用姿势</h2><h3 id="3-1-iOS"><a href="#3-1-iOS" class="headerlink" title="3.1 iOS"></a>3.1 iOS</h3><p>假设需要能够在 arm64 架构下的 iOS 及 macOS 平台下使用，因此需要使用前面生成的库文件和绑定文件创建 xcframework 以便将不同平台和架构的库集成到单个 Framework 中。</p>
<h4 id="3-1-1-环境配置"><a href="#3-1-1-环境配置" class="headerlink" title="3.1.1 环境配置"></a>3.1.1 环境配置</h4><ul>
<li>安装xcode， 跳过</li>
<li>添加工具链</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rustup target add aarch64-apple-ios armv7-apple-ios armv7s-apple-ios x86_64-apple-ios </span><br></pre></td></tr></table></figure>

<ul>
<li>安装 swiftformat</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install swiftformat</span><br></pre></td></tr></table></figure>

<h4 id="3-1-2-iOS-脚本"><a href="#3-1-2-iOS-脚本" class="headerlink" title="3.1.2 iOS 脚本"></a>3.1.2 <strong>iOS 脚本</strong></h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">#<span class="operator">!/</span>bin<span class="operator">/</span>bash</span><br><span class="line"></span><br><span class="line"># 主要步骤：</span><br><span class="line"># 设置变量：</span><br><span class="line"># <span class="type">FFI</span><span class="operator">=</span><span class="string">&quot;mobile_ffi&quot;</span>: 设置变量<span class="type">FFI，代表要处理的Rust库名称</span><span class="operator">。</span></span><br><span class="line"># <span class="type">XC_NAME</span><span class="operator">=</span><span class="string">&quot;mobile_rust&quot;</span>: 设置变量<span class="type">XC_NAME，可能用于指定最终XCFramework的名称</span><span class="operator">。</span></span><br><span class="line"># 进入项目目录：</span><br><span class="line"></span><br><span class="line"># cd <span class="variable">$FFI</span>: 切换到由<span class="type">FFI变量指定的目录</span><span class="operator">。</span></span><br><span class="line"># 为iOS目标构建<span class="type">Rust库：</span></span><br><span class="line"></span><br><span class="line"># 使用<span class="keyword">for</span>循环遍历iOS目标架构（aarch64<span class="operator">-</span>apple<span class="operator">-</span>ios<span class="operator">、</span>aarch64<span class="operator">-</span>apple<span class="operator">-</span>ios<span class="operator">-</span>sim<span class="operator">、</span>x86_64<span class="operator">-</span>apple<span class="operator">-</span>ios）<span class="operator">。</span></span><br><span class="line"># 如果目标是armv7s<span class="operator">-</span>apple<span class="operator">-</span>ios（尽管在循环中并未列出，可能是个遗留条件），则使用<span class="type">Rust的nightly版本和特定的Cargo特性进行构建</span><span class="operator">。</span></span><br><span class="line"># 对于其他目标，使用默认的<span class="type">Cargo命令进行构建</span><span class="operator">。</span></span><br><span class="line"># 注释掉的rustup target add <span class="variable">$TARGET行表明原本可能计划自动安装缺少的目标，但后来决定不执行此操作</span><span class="operator">。</span></span><br><span class="line"># 生成绑定：</span><br><span class="line"></span><br><span class="line"># 使用cargo run <span class="operator">--</span>bin uniffi<span class="operator">-</span>bindgen generate命令生成<span class="type">Swift绑定，指定库文件和输出目录</span><span class="operator">。</span></span><br><span class="line"># 重命名module.modulemap文件：</span><br><span class="line"></span><br><span class="line"># 将生成的<span class="operator">*</span>.modulemap文件重命名为module.modulemap，以符合iOS项目的命名约定<span class="operator">。</span></span><br><span class="line"># 移动<span class="type">Swift文件到项目目录：</span></span><br><span class="line"></span><br><span class="line"># 删除目标项目目录中可能存在的旧<span class="type">Swift文件，然后将新生成的Swift文件移动到正确的位置</span><span class="operator">。</span></span><br><span class="line"># 创建模拟器库：</span><br><span class="line"></span><br><span class="line"># 使用lipo命令合并模拟器架构的库文件，创建一个适用于模拟器的库<span class="operator">。</span></span><br><span class="line"># 注释掉的行表明原本可能还计划为其他架构（如armv7s<span class="operator">-</span>apple<span class="operator">-</span>ios）创建库，但后来决定不执行此操作<span class="operator">。</span></span><br><span class="line"># 创建<span class="type">XCFramework：</span></span><br><span class="line"></span><br><span class="line"># 删除旧的<span class="type">XCFramework（如果有），然后使用xcodebuild</span> <span class="operator">-</span>create<span class="operator">-</span>xcframework命令创建一个新的<span class="type">XCFramework，包含模拟器和真机架构的库</span><span class="operator">。</span></span><br><span class="line"># 清理：</span><br><span class="line"></span><br><span class="line"># 删除临时目录和文件，以保持工作区的整洁<span class="operator">。</span></span><br><span class="line"></span><br><span class="line"><span class="type">FFI</span><span class="operator">=</span><span class="string">&quot;mobile_ffi&quot;</span></span><br><span class="line">cd <span class="variable">$FFI</span></span><br><span class="line"><span class="type">XC_NAME</span><span class="operator">=</span><span class="string">&quot;mobile_rust&quot;</span></span><br><span class="line"># <span class="type">Add</span> the iOS targets and build</span><br><span class="line"><span class="keyword">for</span> <span class="type">TARGET</span> <span class="keyword">in</span> \</span><br><span class="line">        aarch64<span class="operator">-</span>apple<span class="operator">-</span>ios \</span><br><span class="line">        aarch64<span class="operator">-</span>apple<span class="operator">-</span>ios<span class="operator">-</span>sim \</span><br><span class="line">        x86_64<span class="operator">-</span>apple<span class="operator">-</span>ios</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">#   rustup target add <span class="variable">$TARGET</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$TARGET</span> <span class="operator">==</span> <span class="string">&quot;armv7s-apple-ios&quot;</span> ]; then</span><br><span class="line">        cargo <span class="operator">+</span>nightly build <span class="operator">-</span><span class="type">Z</span> build<span class="operator">-</span>std<span class="operator">=</span>std <span class="operator">--</span>release <span class="operator">--</span>target<span class="operator">=</span><span class="variable">$TARGET</span> <span class="operator">--</span>features<span class="operator">=</span>mock</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        cargo build <span class="operator">--</span>release <span class="operator">--</span>target<span class="operator">=</span><span class="variable">$TARGET</span></span><br><span class="line">    fi</span><br><span class="line">done</span><br><span class="line">cd <span class="operator">-</span></span><br><span class="line"></span><br><span class="line"># <span class="type">Generate</span> bindings</span><br><span class="line">cargo run <span class="operator">--</span>bin uniffi<span class="operator">-</span>bindgen generate <span class="operator">--</span>library <span class="operator">./</span>target<span class="regexp">/aarch64-apple-ios/</span>release<span class="regexp">/lib$&#123;FFI&#125;.dylib --language swift --out-dir ./</span>bindings</span><br><span class="line"></span><br><span class="line"># <span class="type">Rename</span> <span class="operator">*</span>.modulemap to module.modulemap</span><br><span class="line">mv <span class="operator">./</span>bindings<span class="regexp">/$&#123;FFI&#125;FFI.modulemap ./</span>bindings<span class="operator">/</span>module.modulemap</span><br><span class="line">mkdir <span class="operator">-</span>p <span class="operator">./</span>dist<span class="regexp">/ios &amp;&amp; cp ./</span>bindings<span class="regexp">/$&#123;FFI&#125;.swift ./</span>dist<span class="operator">/</span>ios</span><br><span class="line"></span><br><span class="line">mkdir sim</span><br><span class="line">lipo <span class="operator">-</span>create <span class="operator">./</span>target<span class="regexp">/x86_64-apple-ios/</span>release<span class="regexp">/lib$&#123;FFI&#125;.a ./</span>target<span class="regexp">/aarch64-apple-ios-sim/</span>release<span class="regexp">/lib$&#123;FFI&#125;.a -output ./</span>sim<span class="operator">/</span>lib$&#123;<span class="type">FFI</span>&#125;.a</span><br><span class="line"># lipo <span class="operator">-</span>create <span class="operator">./</span>target<span class="regexp">/aarch64-apple-ios/</span>release<span class="regexp">/lib$&#123;FFI&#125;.a ./</span>target<span class="regexp">/armv7s-apple-ios/</span>release<span class="regexp">/lib$&#123;FFI&#125;.a -output ./</span>sm<span class="operator">/</span>lib$&#123;<span class="type">FFI</span>&#125;.a</span><br><span class="line"></span><br><span class="line"># <span class="type">Recreate</span> <span class="type">XCFramework</span></span><br><span class="line">rm <span class="operator">-</span>rf <span class="string">&quot;dist/ios/$XC_NAME.xcframework&quot;</span></span><br><span class="line">xcodebuild <span class="operator">-</span>create<span class="operator">-</span>xcframework \</span><br><span class="line">        <span class="operator">-</span>library <span class="operator">./</span>sim<span class="regexp">/lib$&#123;FFI&#125;.a -headers ./</span>bindings \</span><br><span class="line">        <span class="operator">-</span>library <span class="operator">./</span>target<span class="regexp">/aarch64-apple-ios/</span>release<span class="regexp">/lib$&#123;FFI&#125;.a -headers ./</span>bindings \</span><br><span class="line">        <span class="operator">-</span>output <span class="string">&quot;dist/ios/$XC_NAME.xcframework&quot;</span></span><br><span class="line"></span><br><span class="line"># <span class="type">Cleanup</span></span><br><span class="line">rm <span class="operator">-</span>rf bindings sim ios</span><br></pre></td></tr></table></figure>

<p>使用方法：</p>
<p>build_ios_xc.sh 是构建iOS产物的脚本，运行 sh build_ios_xc.sh 即可</p>
<h4 id="3-1-3-生成xcframework"><a href="#3-1-3-生成xcframework" class="headerlink" title="3.1.3 生成xcframework"></a>3.1.3 生成xcframework</h4><ul>
<li>首先我们执行上面的iOS脚本  sh build_ios_xc.sh，等执行完成</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line">sh build_ios_xc.<span class="property">sh</span> </span><br><span class="line"><span class="attr">warning</span>: profiles <span class="keyword">for</span> the non root package will be ignored, specify profiles at the workspace <span class="attr">root</span>:</span><br><span class="line"><span class="attr">package</span>:   <span class="regexp">/Users/y</span>angcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/uniffi/mobile_ffi/<span class="title class_">Cargo</span>.<span class="property">toml</span></span><br><span class="line"><span class="attr">workspace</span>: <span class="regexp">/Users/y</span>angcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/uniffi/<span class="title class_">Cargo</span>.<span class="property">toml</span></span><br><span class="line">   <span class="title class_">Compiling</span> proc-macro2 v1<span class="number">.0</span><span class="number">.92</span></span><br><span class="line">   <span class="title class_">Compiling</span> unicode-ident v1<span class="number">.0</span><span class="number">.14</span></span><br><span class="line">   <span class="title class_">Compiling</span> serde v1<span class="number">.0</span><span class="number">.215</span></span><br><span class="line">   <span class="title class_">Compiling</span> anyhow v1<span class="number">.0</span><span class="number">.93</span></span><br><span class="line">   <span class="title class_">Compiling</span> camino v1<span class="number">.1</span><span class="number">.9</span></span><br><span class="line">   <span class="title class_">Compiling</span> autocfg v1<span class="number">.4</span><span class="number">.0</span></span><br><span class="line">   <span class="title class_">Compiling</span> thiserror v1<span class="number">.0</span><span class="number">.69</span></span><br><span class="line">   <span class="title class_">Compiling</span> serde_json v1<span class="number">.0</span><span class="number">.133</span></span><br><span class="line">   <span class="title class_">Compiling</span> semver v1<span class="number">.0</span><span class="number">.23</span></span><br><span class="line">   <span class="title class_">Compiling</span> fs-err v2<span class="number">.11</span><span class="number">.0</span></span><br><span class="line">   <span class="title class_">Compiling</span> paste v1<span class="number">.0</span><span class="number">.15</span></span><br><span class="line">   <span class="title class_">Compiling</span> itoa v1<span class="number">.0</span><span class="number">.13</span></span><br><span class="line">   <span class="title class_">Compiling</span> memchr v2<span class="number">.7</span><span class="number">.4</span></span><br><span class="line">   <span class="title class_">Compiling</span> bytes v1<span class="number">.8</span><span class="number">.0</span></span><br><span class="line">   <span class="title class_">Compiling</span> siphasher v0<span class="number">.3</span><span class="number">.11</span></span><br><span class="line">   <span class="title class_">Compiling</span> quote v1<span class="number">.0</span><span class="number">.37</span></span><br><span class="line">   <span class="title class_">Compiling</span> ryu v1<span class="number">.0</span><span class="number">.18</span></span><br><span class="line">   <span class="title class_">Compiling</span> syn v2<span class="number">.0</span><span class="number">.89</span></span><br><span class="line">   <span class="title class_">Compiling</span> log v0<span class="number">.4</span><span class="number">.22</span></span><br><span class="line">   <span class="title class_">Compiling</span> once_cell v1<span class="number">.20</span><span class="number">.2</span></span><br><span class="line">   <span class="title class_">Compiling</span> static_assertions v1<span class="number">.1</span><span class="number">.0</span></span><br><span class="line">   <span class="title class_">Compiling</span> mobile v0<span class="number">.1</span><span class="number">.0</span> (<span class="regexp">/Users/y</span>angcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/mobile)</span><br><span class="line"><span class="attr">warning</span>: unused <span class="attr">variable</span>: <span class="string">`e`</span></span><br><span class="line">  --&gt; <span class="regexp">/Users/y</span>angcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/mobile/src/log.<span class="property">rs</span>:<span class="number">14</span>:<span class="number">19</span></span><br><span class="line">   |</span><br><span class="line"><span class="number">14</span> |         .<span class="title function_">map_err</span>(|e| anyhow!(<span class="string">&quot;set logger failed&quot;</span>))?;</span><br><span class="line">   |                   ^ <span class="attr">help</span>: <span class="keyword">if</span> <span class="variable language_">this</span> is intentional, prefix it <span class="keyword">with</span> an <span class="attr">underscore</span>: <span class="string">`_e`</span></span><br><span class="line">   |</span><br><span class="line">   = <span class="attr">note</span>: <span class="string">`#[warn(unused_variables)]`</span> on by <span class="keyword">default</span></span><br><span class="line"></span><br><span class="line"><span class="attr">warning</span>: <span class="string">`mobile`</span> (lib) generated <span class="number">1</span> warning</span><br><span class="line">   <span class="title class_">Compiling</span> uniffi_core v0<span class="number">.28</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> serde_derive v1<span class="number">.0</span><span class="number">.215</span></span><br><span class="line">   <span class="title class_">Compiling</span> uniffi_checksum_derive v0<span class="number">.28</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> thiserror-impl v1<span class="number">.0</span><span class="number">.69</span></span><br><span class="line">   <span class="title class_">Compiling</span> uniffi_meta v0<span class="number">.28</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> toml v0<span class="number">.5</span><span class="number">.11</span></span><br><span class="line">   <span class="title class_">Compiling</span> bincode v1<span class="number">.3</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> cargo-platform v0<span class="number">.1</span><span class="number">.8</span></span><br><span class="line">   <span class="title class_">Compiling</span> cargo_metadata v0<span class="number">.15</span><span class="number">.4</span></span><br><span class="line">   <span class="title class_">Compiling</span> uniffi_macros v0<span class="number">.28</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> uniffi v0<span class="number">.28</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> mobile_ffi v0<span class="number">.1</span><span class="number">.0</span> (<span class="regexp">/Users/y</span>angcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/uniffi/mobile_ffi)</span><br><span class="line">    <span class="title class_">Finished</span> <span class="string">`release`</span> profile [optimized + debuginfo] <span class="title function_">target</span>(s) <span class="keyword">in</span> <span class="number">25.</span>40s</span><br><span class="line"><span class="attr">warning</span>: profiles <span class="keyword">for</span> the non root package will be ignored, specify profiles at the workspace <span class="attr">root</span>:</span><br><span class="line"><span class="attr">package</span>:   <span class="regexp">/Users/y</span>angcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/uniffi/mobile_ffi/<span class="title class_">Cargo</span>.<span class="property">toml</span></span><br><span class="line"><span class="attr">workspace</span>: <span class="regexp">/Users/y</span>angcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/uniffi/<span class="title class_">Cargo</span>.<span class="property">toml</span></span><br><span class="line">   <span class="title class_">Compiling</span> serde v1<span class="number">.0</span><span class="number">.215</span></span><br><span class="line">   <span class="title class_">Compiling</span> anyhow v1<span class="number">.0</span><span class="number">.93</span></span><br><span class="line">   <span class="title class_">Compiling</span> semver v1<span class="number">.0</span><span class="number">.23</span></span><br><span class="line">   <span class="title class_">Compiling</span> serde_json v1<span class="number">.0</span><span class="number">.133</span></span><br><span class="line">   <span class="title class_">Compiling</span> camino v1<span class="number">.1</span><span class="number">.9</span></span><br><span class="line">   <span class="title class_">Compiling</span> thiserror v1<span class="number">.0</span><span class="number">.69</span></span><br><span class="line">   <span class="title class_">Compiling</span> ryu v1<span class="number">.0</span><span class="number">.18</span></span><br><span class="line">   <span class="title class_">Compiling</span> itoa v1<span class="number">.0</span><span class="number">.13</span></span><br><span class="line">   <span class="title class_">Compiling</span> memchr v2<span class="number">.7</span><span class="number">.4</span></span><br><span class="line">   <span class="title class_">Compiling</span> once_cell v1<span class="number">.20</span><span class="number">.2</span></span><br><span class="line">   <span class="title class_">Compiling</span> static_assertions v1<span class="number">.1</span><span class="number">.0</span></span><br><span class="line">   <span class="title class_">Compiling</span> bytes v1<span class="number">.8</span><span class="number">.0</span></span><br><span class="line">   <span class="title class_">Compiling</span> log v0<span class="number">.4</span><span class="number">.22</span></span><br><span class="line">   <span class="title class_">Compiling</span> mobile v0<span class="number">.1</span><span class="number">.0</span> (<span class="regexp">/Users/y</span>angcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/mobile)</span><br><span class="line"><span class="attr">warning</span>: unused <span class="attr">variable</span>: <span class="string">`e`</span></span><br><span class="line">  --&gt; <span class="regexp">/Users/y</span>angcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/mobile/src/log.<span class="property">rs</span>:<span class="number">14</span>:<span class="number">19</span></span><br><span class="line">   |</span><br><span class="line"><span class="number">14</span> |         .<span class="title function_">map_err</span>(|e| anyhow!(<span class="string">&quot;set logger failed&quot;</span>))?;</span><br><span class="line">   |                   ^ <span class="attr">help</span>: <span class="keyword">if</span> <span class="variable language_">this</span> is intentional, prefix it <span class="keyword">with</span> an <span class="attr">underscore</span>: <span class="string">`_e`</span></span><br><span class="line">   |</span><br><span class="line">   = <span class="attr">note</span>: <span class="string">`#[warn(unused_variables)]`</span> on by <span class="keyword">default</span></span><br><span class="line"></span><br><span class="line"><span class="attr">warning</span>: <span class="string">`mobile`</span> (lib) generated <span class="number">1</span> warning</span><br><span class="line">   <span class="title class_">Compiling</span> uniffi_core v0<span class="number">.28</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> cargo-platform v0<span class="number">.1</span><span class="number">.8</span></span><br><span class="line">   <span class="title class_">Compiling</span> cargo_metadata v0<span class="number">.15</span><span class="number">.4</span></span><br><span class="line">   <span class="title class_">Compiling</span> uniffi v0<span class="number">.28</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> mobile_ffi v0<span class="number">.1</span><span class="number">.0</span> (<span class="regexp">/Users/y</span>angcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/uniffi/mobile_ffi)</span><br><span class="line">    <span class="title class_">Finished</span> <span class="string">`release`</span> profile [optimized + debuginfo] <span class="title function_">target</span>(s) <span class="keyword">in</span> <span class="number">13.</span>09s</span><br><span class="line"><span class="attr">warning</span>: profiles <span class="keyword">for</span> the non root package will be ignored, specify profiles at the workspace <span class="attr">root</span>:</span><br><span class="line"><span class="attr">package</span>:   <span class="regexp">/Users/y</span>angcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/uniffi/mobile_ffi/<span class="title class_">Cargo</span>.<span class="property">toml</span></span><br><span class="line"><span class="attr">workspace</span>: <span class="regexp">/Users/y</span>angcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/uniffi/<span class="title class_">Cargo</span>.<span class="property">toml</span></span><br><span class="line">   <span class="title class_">Compiling</span> serde v1<span class="number">.0</span><span class="number">.215</span></span><br><span class="line">   <span class="title class_">Compiling</span> anyhow v1<span class="number">.0</span><span class="number">.93</span></span><br><span class="line">   <span class="title class_">Compiling</span> serde_json v1<span class="number">.0</span><span class="number">.133</span></span><br><span class="line">   <span class="title class_">Compiling</span> thiserror v1<span class="number">.0</span><span class="number">.69</span></span><br><span class="line">   <span class="title class_">Compiling</span> camino v1<span class="number">.1</span><span class="number">.9</span></span><br><span class="line">   <span class="title class_">Compiling</span> semver v1<span class="number">.0</span><span class="number">.23</span></span><br><span class="line">   <span class="title class_">Compiling</span> ryu v1<span class="number">.0</span><span class="number">.18</span></span><br><span class="line">   <span class="title class_">Compiling</span> memchr v2<span class="number">.7</span><span class="number">.4</span></span><br><span class="line">   <span class="title class_">Compiling</span> itoa v1<span class="number">.0</span><span class="number">.13</span></span><br><span class="line">   <span class="title class_">Compiling</span> once_cell v1<span class="number">.20</span><span class="number">.2</span></span><br><span class="line">   <span class="title class_">Compiling</span> bytes v1<span class="number">.8</span><span class="number">.0</span></span><br><span class="line">   <span class="title class_">Compiling</span> static_assertions v1<span class="number">.1</span><span class="number">.0</span></span><br><span class="line">   <span class="title class_">Compiling</span> log v0<span class="number">.4</span><span class="number">.22</span></span><br><span class="line">   <span class="title class_">Compiling</span> mobile v0<span class="number">.1</span><span class="number">.0</span> (<span class="regexp">/Users/y</span>angcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/mobile)</span><br><span class="line"><span class="attr">warning</span>: unused <span class="attr">variable</span>: <span class="string">`e`</span></span><br><span class="line">  --&gt; <span class="regexp">/Users/y</span>angcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/mobile/src/log.<span class="property">rs</span>:<span class="number">14</span>:<span class="number">19</span></span><br><span class="line">   |</span><br><span class="line"><span class="number">14</span> |         .<span class="title function_">map_err</span>(|e| anyhow!(<span class="string">&quot;set logger failed&quot;</span>))?;</span><br><span class="line">   |                   ^ <span class="attr">help</span>: <span class="keyword">if</span> <span class="variable language_">this</span> is intentional, prefix it <span class="keyword">with</span> an <span class="attr">underscore</span>: <span class="string">`_e`</span></span><br><span class="line">   |</span><br><span class="line">   = <span class="attr">note</span>: <span class="string">`#[warn(unused_variables)]`</span> on by <span class="keyword">default</span></span><br><span class="line"></span><br><span class="line"><span class="attr">warning</span>: <span class="string">`mobile`</span> (lib) generated <span class="number">1</span> warning</span><br><span class="line">   <span class="title class_">Compiling</span> uniffi_core v0<span class="number">.28</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> cargo-platform v0<span class="number">.1</span><span class="number">.8</span></span><br><span class="line">   <span class="title class_">Compiling</span> cargo_metadata v0<span class="number">.15</span><span class="number">.4</span></span><br><span class="line">   <span class="title class_">Compiling</span> uniffi v0<span class="number">.28</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> mobile_ffi v0<span class="number">.1</span><span class="number">.0</span> (<span class="regexp">/Users/y</span>angcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/uniffi/mobile_ffi)</span><br><span class="line">    <span class="title class_">Finished</span> <span class="string">`release`</span> profile [optimized + debuginfo] <span class="title function_">target</span>(s) <span class="keyword">in</span> <span class="number">11.</span>31s</span><br><span class="line">/<span class="title class_">Users</span>/yangcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/uniffi</span><br><span class="line"><span class="attr">warning</span>: profiles <span class="keyword">for</span> the non root package will be ignored, specify profiles at the workspace <span class="attr">root</span>:</span><br><span class="line"><span class="attr">package</span>:   <span class="regexp">/Users/y</span>angcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/uniffi/mobile_ffi/<span class="title class_">Cargo</span>.<span class="property">toml</span></span><br><span class="line"><span class="attr">workspace</span>: <span class="regexp">/Users/y</span>angcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/uniffi/<span class="title class_">Cargo</span>.<span class="property">toml</span></span><br><span class="line">   <span class="title class_">Compiling</span> memchr v2<span class="number">.7</span><span class="number">.4</span></span><br><span class="line">   <span class="title class_">Compiling</span> minimal-lexical v0<span class="number">.2</span><span class="number">.1</span></span><br><span class="line">   <span class="title class_">Compiling</span> anyhow v1<span class="number">.0</span><span class="number">.93</span></span><br><span class="line">   <span class="title class_">Compiling</span> once_cell v1<span class="number">.20</span><span class="number">.2</span></span><br><span class="line">   <span class="title class_">Compiling</span> ryu v1<span class="number">.0</span><span class="number">.18</span></span><br><span class="line">   <span class="title class_">Compiling</span> itoa v1<span class="number">.0</span><span class="number">.13</span></span><br><span class="line">   <span class="title class_">Compiling</span> serde v1<span class="number">.0</span><span class="number">.215</span></span><br><span class="line">   <span class="title class_">Compiling</span> bytes v1<span class="number">.8</span><span class="number">.0</span></span><br><span class="line">   <span class="title class_">Compiling</span> thiserror v1<span class="number">.0</span><span class="number">.69</span></span><br><span class="line">   <span class="title class_">Compiling</span> fs-err v2<span class="number">.11</span><span class="number">.0</span></span><br><span class="line">   <span class="title class_">Compiling</span> utf8parse v0<span class="number">.2</span><span class="number">.2</span></span><br><span class="line">   <span class="title class_">Compiling</span> siphasher v0<span class="number">.3</span><span class="number">.11</span></span><br><span class="line">   <span class="title class_">Compiling</span> anstyle-parse v0<span class="number">.2</span><span class="number">.6</span></span><br><span class="line">   <span class="title class_">Compiling</span> heck v0<span class="number">.5</span><span class="number">.0</span></span><br><span class="line">   <span class="title class_">Compiling</span> uniffi_meta v0<span class="number">.28</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> log v0<span class="number">.4</span><span class="number">.22</span></span><br><span class="line">   <span class="title class_">Compiling</span> smawk v0<span class="number">.3</span><span class="number">.2</span></span><br><span class="line">   <span class="title class_">Compiling</span> nom v7<span class="number">.1</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> anstyle-query v1<span class="number">.1</span><span class="number">.2</span></span><br><span class="line">   <span class="title class_">Compiling</span> anstyle v1<span class="number">.0</span><span class="number">.10</span></span><br><span class="line">   <span class="title class_">Compiling</span> is_terminal_polyfill v1<span class="number">.70</span><span class="number">.1</span></span><br><span class="line">   <span class="title class_">Compiling</span> colorchoice v1<span class="number">.0</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> textwrap v0<span class="number">.16</span><span class="number">.1</span></span><br><span class="line">   <span class="title class_">Compiling</span> scroll v0<span class="number">.12</span><span class="number">.0</span></span><br><span class="line">   <span class="title class_">Compiling</span> clap_lex v0<span class="number">.7</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> anstream v0<span class="number">.6</span><span class="number">.18</span></span><br><span class="line">   <span class="title class_">Compiling</span> askama_escape v0<span class="number">.10</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> plain v0<span class="number">.2</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> strsim v0<span class="number">.11</span><span class="number">.1</span></span><br><span class="line">   <span class="title class_">Compiling</span> clap_derive v4<span class="number">.5</span><span class="number">.18</span></span><br><span class="line">   <span class="title class_">Compiling</span> goblin v0<span class="number">.8</span><span class="number">.2</span></span><br><span class="line">   <span class="title class_">Compiling</span> clap_builder v4<span class="number">.5</span><span class="number">.21</span></span><br><span class="line">   <span class="title class_">Compiling</span> glob v0<span class="number">.3</span><span class="number">.1</span></span><br><span class="line">   <span class="title class_">Compiling</span> static_assertions v1<span class="number">.1</span><span class="number">.0</span></span><br><span class="line">   <span class="title class_">Compiling</span> uniffi_core v0<span class="number">.28</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> askama_parser v0<span class="number">.2</span><span class="number">.1</span></span><br><span class="line">   <span class="title class_">Compiling</span> weedle2 v5<span class="number">.0</span><span class="number">.0</span></span><br><span class="line">   <span class="title class_">Compiling</span> camino v1<span class="number">.1</span><span class="number">.9</span></span><br><span class="line">   <span class="title class_">Compiling</span> semver v1<span class="number">.0</span><span class="number">.23</span></span><br><span class="line">   <span class="title class_">Compiling</span> serde_json v1<span class="number">.0</span><span class="number">.133</span></span><br><span class="line">   <span class="title class_">Compiling</span> cargo-platform v0<span class="number">.1</span><span class="number">.8</span></span><br><span class="line">   <span class="title class_">Compiling</span> basic-toml v0<span class="number">.1</span><span class="number">.9</span></span><br><span class="line">   <span class="title class_">Compiling</span> toml v0<span class="number">.5</span><span class="number">.11</span></span><br><span class="line">   <span class="title class_">Compiling</span> bincode v1<span class="number">.3</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> cargo_metadata v0<span class="number">.15</span><span class="number">.4</span></span><br><span class="line">   <span class="title class_">Compiling</span> clap v4<span class="number">.5</span><span class="number">.21</span></span><br><span class="line">   <span class="title class_">Compiling</span> askama_derive v0<span class="number">.12</span><span class="number">.5</span></span><br><span class="line">   <span class="title class_">Compiling</span> uniffi_testing v0<span class="number">.28</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> uniffi_macros v0<span class="number">.28</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> uniffi_udl v0<span class="number">.28</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> askama v0<span class="number">.12</span><span class="number">.1</span></span><br><span class="line">   <span class="title class_">Compiling</span> uniffi_bindgen v0<span class="number">.28</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> uniffi v0<span class="number">.28</span><span class="number">.3</span></span><br><span class="line">   <span class="title class_">Compiling</span> uniffi-bindgen v0<span class="number">.1</span><span class="number">.0</span> (<span class="regexp">/Users/y</span>angcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/uniffi/uniffi-bindgen)</span><br><span class="line">    <span class="title class_">Finished</span> <span class="string">`dev`</span> profile [unoptimized + debuginfo] <span class="title function_">target</span>(s) <span class="keyword">in</span> <span class="number">20.</span>30s</span><br><span class="line">     <span class="title class_">Running</span> <span class="string">`target/debug/uniffi-bindgen generate --library ./target/aarch64-apple-ios/release/libmobile_ffi.dylib --language swift --out-dir ./bindings`</span></span><br><span class="line"><span class="title class_">Warning</span>: <span class="title class_">Unable</span> to auto-format mobile_ffi.<span class="property">swift</span> <span class="keyword">using</span> <span class="attr">swiftformat</span>: <span class="title class_">Os</span> &#123; <span class="attr">code</span>: <span class="number">2</span>, <span class="attr">kind</span>: <span class="title class_">NotFound</span>, <span class="attr">message</span>: <span class="string">&quot;No such file or directory&quot;</span> &#125;</span><br><span class="line"><span class="attr">rm</span>: ./dist/ios/swift/mobile_ffi.<span class="property">swift</span>: <span class="title class_">No</span> such file or directory</span><br><span class="line">xcframework successfully written out <span class="attr">to</span>: <span class="regexp">/Users/y</span>angcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/uniffi/dist/ios/mobile.<span class="property">xcframework</span></span><br></pre></td></tr></table></figure>

<ul>
<li>输出：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcframework successfully written out <span class="attr">to</span>: <span class="regexp">/Users/y</span>angcong/<span class="title class_">Documents</span>/<span class="title class_">RustProject</span>/mobile_rust_demo/uniffi/dist/ios/mobile.<span class="property">xcframework</span>  </span><br></pre></td></tr></table></figure>

<p><img src="https://tjny2v67lw.feishu.cn/space/api/box/stream/download/asynccode/?code=YmI4Y2FkNjJlZWNmNjc5MWM0MGFjMmMwODZlNmY3ZjhfcllpMjVxZ1JOWjhvWDU2QVYwNmZQb1JxRldBdEZDWVdfVG9rZW46VlZDT2JqYXlnb1lCbUR4VmV5ZWNRUDh4bnFnXzE3NDIxOTM2OTE6MTc0MjE5NzI5MV9WNA" alt="img"></p>
<h4 id="3-1-4-将xcframework-以及-Swift-集成到xcode"><a href="#3-1-4-将xcframework-以及-Swift-集成到xcode" class="headerlink" title="3.1.4 将xcframework 以及 Swift 集成到xcode"></a>3.1.4 将xcframework 以及 Swift 集成到xcode</h4><ul>
<li>将xcframework 放到xcode</li>
</ul>
<p><img src="https://tjny2v67lw.feishu.cn/space/api/box/stream/download/asynccode/?code=MmRmM2FiYThiYjdlNGZkOWRmMzM3YzllZDkxOTExYjNfOUkxYkQ0MTkwTFlhOUF0OXNtbWw5QWhTTWk2UExtd3lfVG9rZW46WjlxNmJiSHRHb0piMXF4dVlZWmNXV0lJbndiXzE3NDIxOTM2OTE6MTc0MjE5NzI5MV9WNA" alt="img"></p>
<h4 id="3-1-5-将Swift文件，拖动到工程中"><a href="#3-1-5-将Swift文件，拖动到工程中" class="headerlink" title="3.1.5 将Swift文件，拖动到工程中"></a>3.1.5 将Swift文件，拖动到工程中</h4><p><img src="https://tjny2v67lw.feishu.cn/space/api/box/stream/download/asynccode/?code=OGQ2YjE2OGI4MTVjN2YwNDZmYzI5MGUzYmVjMjMyYTlfSjFUVTRrR1ZLeFdnQ1ZwMEZwUExFdmdxZ2RUVk1DM01fVG9rZW46QWtQYmJ3Uk16b3MySEt4RlhvTWNZenRLbnplXzE3NDIxOTM2OTE6MTc0MjE5NzI5MV9WNA" alt="img"></p>
<h4 id="3-1-6-调用rust生成的方法"><a href="#3-1-6-调用rust生成的方法" class="headerlink" title="3.1.6 调用rust生成的方法"></a>3.1.6 调用rust生成的方法</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@objcMembers</span></span><br><span class="line"><span class="keyword">@objc(YCTestRustTool)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">YCTestRustTool</span>: <span class="title class_ inherited__">NSObject</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">testRust</span>() &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> content <span class="operator">=</span> sayHi()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;来自rust的值&quot;</span> <span class="operator">+</span> content)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> map <span class="operator">=</span> <span class="type">UniffiHandleMap</span>&lt;<span class="keyword">Any</span>&gt;()</span><br><span class="line">        <span class="keyword">_</span> <span class="operator">=</span> map.insert(obj: <span class="string">&quot;洋葱&quot;</span>)</span><br><span class="line">        <span class="keyword">_</span> <span class="operator">=</span> map.insert(obj: <span class="string">&quot;数学&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;插入后的map=&quot;</span>, map)</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> value <span class="operator">=</span> <span class="keyword">try</span> map.get(handle: <span class="number">1</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;获取索引为1的值&quot;</span>, value)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> map.remove(handle: <span class="number">1</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;移除后的map=&quot;</span>, map)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-Android"><a href="#3-2-Android" class="headerlink" title="3.2 Android"></a>3.2 Android</h3><h4 id="3-2-1-环境配置"><a href="#3-2-1-环境配置" class="headerlink" title="3.2.1  环境配置"></a>3.2.1  环境配置</h4><ul>
<li><p>安装ndk</p>
<ul>
<li><p>可以使用Android studio 安装，然后配置环境变量</p>
</li>
<li><p><img src="https://tjny2v67lw.feishu.cn/space/api/box/stream/download/asynccode/?code=NjYxOGI1Mzc2NjA5NjRkOWVjMDQxYjFmZDYyNzMyNjRfYXVUUTRGT2xES3pDMnNibndadnpzODZFejJDbERtNzhfVG9rZW46SHhpeGJXb0x3b0U0Qzl4YVFNTWNwWVJobjZjXzE3NDIxOTM2OTE6MTc0MjE5NzI5MV9WNA" alt="img"></p>
</li>
<li><p><img src="https://tjny2v67lw.feishu.cn/space/api/box/stream/download/asynccode/?code=Yzk4NGM2MjlmNmYyMDViNmFkOGNhMjRhMWFjODBmNzZfelM4ZG5pMFN6ZXJTdmk2cGd5YU4ybUVJcGhlbGNKMGdfVG9rZW46UmJUR2J4VnM5b1kwZXZ4TDNhYmNDZGtUbk9jXzE3NDIxOTM2OTE6MTc0MjE5NzI5MV9WNA" alt="img"></p>
</li>
<li><p>使用cargo 安装ndk </p>
</li>
<li><pre><code class="TypeScript">cargo install cargo-ndk
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 安装工具链</span><br><span class="line"></span><br><span class="line">  - ```TypeScript</span><br><span class="line">    rustup target add aarch64-linux-android   </span><br><span class="line">    rustup target add armv7-linux-androideabi</span><br><span class="line">    rustup target add i686-linux-android x86_64-linux-android        </span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
<li><p><strong>确保</strong> <strong><code>ktlint</code></strong> <strong>已安装</strong></p>
</li>
</ul>
<p> 运行以下命令检查 <code>ktlint</code> 是否可用：</p>
<p> <code>ktlint --version</code></p>
<p> 如果未安装，可以使用以下命令安装：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="operator">-</span>sSLO https:<span class="comment">//github.com/pinterest/ktlint/releases/latest/download/ktlint &amp;&amp; chmod a+x ktlint</span></span><br><span class="line">sudo mv ktlint <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-Android-脚本"><a href="#3-2-2-Android-脚本" class="headerlink" title="3.2.2  Android 脚本"></a>3.2.2  <strong>Android 脚本</strong></h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&lt;&lt;</span>&#x27;<span class="type">COMMENT</span>&#x27;</span><br><span class="line">主要用于构建和准备用于<span class="type">Android平台的Rust库，并生成对应的Kotlin绑定代码</span><span class="operator">。</span>下面是详细的步骤解释：</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. 设置环境变量：</span><br><span class="line"><span class="type">FFI</span><span class="operator">=</span><span class="string">&quot;mobile_ffi&quot;</span>：设置环境变量<span class="type">FFI的值为mobile_ffi，这个值将在后续步骤中用于指定库名和文件路径</span><span class="operator">。</span></span><br><span class="line"><span class="type">ANDROID_STRIP</span><span class="operator">=</span><span class="string">&quot;/Users/yangcong/Library/Android/sdk/ndk/25.1.8937393/toolchains/llvm/prebuilt/darwin-x86_64/bin/llvm-strip&quot;</span>：设置环境变量<span class="type">ANDROID_STRIP，指向Android</span> <span class="type">NDK中的llvm</span><span class="operator">-</span>strip工具路径<span class="operator">。</span>llvm<span class="operator">-</span>strip用于移除二进制文件中的符号表，以减少文件大小<span class="operator">。</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. 构建<span class="type">Rust库：</span></span><br><span class="line">cd <span class="variable">$FFI：切换到mobile_ffi目录（即环境变量FFI指定的目录）</span><span class="operator">。</span></span><br><span class="line"># cargo clean：这一行被注释掉了，如果取消注释，它将会清理之前的构建产物<span class="operator">。</span></span><br><span class="line">cargo ndk build <span class="operator">-</span>r：使用cargo<span class="operator">-</span>ndk插件构建<span class="type">Rust库，</span><span class="operator">-</span>r参数可能表示“release”模式，但这不是cargo ndk的标准参数，可能是特定于环境的配置或脚本的一部分<span class="operator">。</span></span><br><span class="line">cd <span class="operator">..</span>：返回到上一级目录<span class="operator">。</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>. 生成<span class="type">Kotlin绑定：</span></span><br><span class="line">cargo run <span class="operator">--</span>bin uniffi<span class="operator">-</span>bindgen generate <span class="operator">--</span>library <span class="operator">./</span>target<span class="regexp">/aarch64-linux-android/</span>release<span class="regexp">/lib$FFI.so --language kotlin --out-dir ./</span>bindings：使用uniffi<span class="operator">-</span>bindgen工具生成<span class="type">Kotlin绑定代码</span><span class="operator">。</span>这里指定了生成的绑定是基于aarch64<span class="operator">-</span>linux<span class="operator">-</span>android架构的release版本的libmobile_ffi.so库，输出目录为<span class="operator">./</span>bindings<span class="operator">。</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span>. 准备<span class="type">Android发布文件：</span></span><br><span class="line">cp <span class="operator">-</span>r bindings<span class="regexp">/com ./</span>dist<span class="regexp">/android/</span>kotlin：将生成的<span class="type">Kotlin绑定代码复制到发布目录的相应位置</span><span class="operator">。</span></span><br><span class="line"># rm <span class="operator">-</span>rf bindings  移除bindings目录，以清理临时文件</span><br><span class="line"></span><br><span class="line"><span class="number">5</span>. 复制库文件到<span class="type">Android架构对应的目录：</span></span><br><span class="line">cp <span class="operator">./</span>target<span class="regexp">/aarch64-linux-android/</span>release<span class="regexp">/lib$FFI.so ./</span>dist<span class="regexp">/android/</span>symbol<span class="regexp">/arm64-v8a/</span>：将aarch64架构的库文件复制到arm64<span class="operator">-</span>v8a目录<span class="operator">。</span></span><br><span class="line">cp <span class="operator">./</span>target<span class="regexp">/armv7-linux-androideabi/</span>release<span class="regexp">/lib$FFI.so ./</span>dist<span class="regexp">/android/</span>symbol<span class="regexp">/armeabi-v7a/</span>：将armv7架构的库文件复制到armeabi<span class="operator">-</span>v7a目录<span class="operator">。</span></span><br><span class="line"></span><br><span class="line"><span class="number">6</span>. 使用llvm<span class="operator">-</span>strip移除符号表：</span><br><span class="line">mv <span class="operator">./</span>target<span class="regexp">/aarch64-linux-android/</span>release<span class="regexp">/lib$FFI.so ./</span>dist<span class="regexp">/android/</span>strip<span class="regexp">/arm64-v8a/</span> 和 mv <span class="operator">./</span>target<span class="regexp">/armv7-linux-androideabi/</span>release<span class="regexp">/lib$FFI.so ./</span>dist<span class="regexp">/android/</span>strip<span class="regexp">/armeabi-v7a/</span>：将库文件移动到用于剥离符号表的目录<span class="operator">。</span></span><br><span class="line">$&#123;<span class="type">ANDROID_STRIP</span>&#125; <span class="operator">--</span>strip<span class="operator">-</span>all <span class="operator">./</span>dist<span class="regexp">/android/</span>strip<span class="regexp">/arm64-v8a/</span>lib<span class="variable">$FFI</span>.so 和 $&#123;<span class="type">ANDROID_STRIP</span>&#125; <span class="operator">--</span>strip<span class="operator">-</span>all <span class="operator">./</span>dist<span class="regexp">/android/</span>strip<span class="regexp">/armeabi-v7a/</span>lib<span class="variable">$FFI</span>.so：使用llvm<span class="operator">-</span>strip工具移除指定库文件的所有符号表信息，以减少文件大小<span class="operator">。</span></span><br><span class="line"></span><br><span class="line">这段脚本的目的是为了构建<span class="type">Rust库，生成对应的Kotlin绑定代码，并准备Android平台所需的库文件，包括复制库文件到正确的架构目录和使用llvm</span><span class="operator">-</span>strip工具移除符号表以减少文件大小<span class="operator">。</span></span><br><span class="line"></span><br><span class="line"><span class="type">COMMENT</span></span><br><span class="line"></span><br><span class="line">#<span class="operator">!/</span>bin<span class="operator">/</span>bash</span><br><span class="line"><span class="type">FFI</span><span class="operator">=</span><span class="string">&quot;mobile_ffi&quot;</span></span><br><span class="line"></span><br><span class="line"># 检查环境变量<span class="type">ANDROID_NDK_HOME是否存在</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="operator">-</span>z <span class="string">&quot;$ANDROID_NDK_HOME&quot;</span> ]; then</span><br><span class="line">    echo <span class="string">&quot;ANDROID_NDK_HOME is not set.&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    echo <span class="string">&quot;ANDROID_NDK_HOME is set to $ANDROID_NDK_PATH&quot;</span></span><br><span class="line">fi</span><br><span class="line"><span class="type">ANDROID_STRIP</span><span class="operator">=/</span><span class="type">Users</span><span class="regexp">/yangcong/</span><span class="type">Library</span><span class="regexp">/Android/</span>sdk<span class="regexp">/ndk/</span><span class="number">25.1</span>.<span class="number">8937393</span><span class="regexp">/toolchains/</span>llvm<span class="regexp">/prebuilt/</span>darwin<span class="operator">-</span>x86_64<span class="regexp">/bin/</span>llvm<span class="operator">-</span>strip</span><br><span class="line"></span><br><span class="line">cd <span class="variable">$FFI</span></span><br><span class="line"># cargo clean</span><br><span class="line">cargo ndk build <span class="operator">-</span>r</span><br><span class="line">cd <span class="operator">..</span></span><br><span class="line">cargo run <span class="operator">--</span>bin uniffi<span class="operator">-</span>bindgen generate <span class="operator">--</span>library <span class="operator">./</span>target<span class="regexp">/aarch64-linux-android/</span>release<span class="regexp">/lib$FFI.so --language kotlin --out-dir ./</span>bindings</span><br><span class="line">mkdir <span class="operator">-</span>p <span class="operator">./</span>dist<span class="regexp">/android/</span>kotlin <span class="operator">&amp;&amp;</span> cp <span class="operator">-</span>r bindings<span class="regexp">/com ./</span>dist<span class="regexp">/android/</span>kotlin</span><br><span class="line">cp <span class="operator">-</span>r bindings<span class="regexp">/com ./</span>dist<span class="regexp">/android/</span>kotlin</span><br><span class="line">cd bindings</span><br><span class="line">rm <span class="operator">-</span>rf com</span><br><span class="line">cd <span class="operator">-</span></span><br><span class="line">rm <span class="operator">-</span>rf bindings</span><br><span class="line"></span><br><span class="line">mkdir <span class="operator">-</span>p <span class="operator">./</span>dist<span class="regexp">/android/</span>strip<span class="regexp">/arm64-v8a/</span> <span class="operator">&amp;&amp;</span> mv <span class="operator">./</span>target<span class="regexp">/aarch64-linux-android/</span>release<span class="regexp">/lib$FFI.so ./</span>dist<span class="regexp">/android/</span>strip<span class="regexp">/arm64-v8a/</span></span><br><span class="line">$&#123;<span class="type">ANDROID_STRIP</span>&#125; <span class="operator">--</span>strip<span class="operator">-</span>all <span class="operator">./</span>dist<span class="regexp">/android/</span>strip<span class="regexp">/arm64-v8a/</span>lib<span class="variable">$FFI</span>.so</span><br><span class="line">mkdir <span class="operator">-</span>p <span class="operator">./</span>dist<span class="regexp">/android/</span>strip<span class="regexp">/armeabi-v7a/</span> <span class="operator">&amp;&amp;</span> mv <span class="operator">./</span>target<span class="regexp">/armv7-linux-androideabi/</span>release<span class="regexp">/lib$FFI.so ./</span>dist<span class="regexp">/android/</span>strip<span class="regexp">/armeabi-v7a/</span></span><br><span class="line">$&#123;<span class="type">ANDROID_STRIP</span>&#125; <span class="operator">--</span>strip<span class="operator">-</span>all <span class="operator">./</span>dist<span class="regexp">/android/</span>strip<span class="regexp">/armeabi-v7a/</span>lib<span class="variable">$FFI</span>.so</span><br></pre></td></tr></table></figure>

<p> 运行脚本：</p>
<p> build_android.sh 是构建Android产物的脚本，运行 sh build_android.sh 即可</p>
<h4 id="3-2-3-生成-so-文件和kotlin文件"><a href="#3-2-3-生成-so-文件和kotlin文件" class="headerlink" title="3.2.3  生成.so 文件和kotlin文件"></a>3.2.3  生成.so 文件和kotlin文件</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">sh build_android.sh</span><br><span class="line">warning: `<span class="regexp">/Users/</span>yangcong<span class="regexp">/.cargo/</span>config` <span class="keyword">is</span> deprecated <span class="keyword">in</span> favor of `config.toml`</span><br><span class="line">note: <span class="keyword">if</span> you need to support cargo <span class="number">1.38</span> or earlier, you can symlink `config` to `config.toml`</span><br><span class="line">warning: `<span class="regexp">/Users/</span>yangcong<span class="regexp">/.cargo/</span>config` <span class="keyword">is</span> deprecated <span class="keyword">in</span> favor of `config.toml`</span><br><span class="line">note: <span class="keyword">if</span> you need to support cargo <span class="number">1.38</span> or earlier, you can symlink `config` to `config.toml`</span><br><span class="line">    <span class="type">Building</span> armeabi<span class="operator">-</span>v7a (armv7<span class="operator">-</span>linux<span class="operator">-</span>androideabi)</span><br><span class="line">warning: `<span class="regexp">/Users/</span>yangcong<span class="regexp">/.cargo/</span>config` <span class="keyword">is</span> deprecated <span class="keyword">in</span> favor of `config.toml`</span><br><span class="line">note: <span class="keyword">if</span> you need to support cargo <span class="number">1.38</span> or earlier, you can symlink `config` to `config.toml`</span><br><span class="line">warning: `<span class="regexp">/Users/</span>yangcong<span class="regexp">/.cargo/</span>config` <span class="keyword">is</span> deprecated <span class="keyword">in</span> favor of `config.toml`</span><br><span class="line">note: <span class="keyword">if</span> you need to support cargo <span class="number">1.38</span> or earlier, you can symlink `config` to `config.toml`</span><br><span class="line">warning: profiles <span class="keyword">for</span> the non root <span class="keyword">package</span> will be ignored, specify profiles at the workspace root:</span><br><span class="line"><span class="keyword">package</span>:   <span class="regexp">/Users/</span>yangcong<span class="regexp">/Documents/</span><span class="type">RustProject</span><span class="regexp">/mobile_rust_demo/</span>uniffi<span class="regexp">/mobile_ffi/</span><span class="type">Cargo</span>.toml</span><br><span class="line">workspace: <span class="regexp">/Users/</span>yangcong<span class="regexp">/Documents/</span><span class="type">RustProject</span><span class="regexp">/mobile_rust_demo/</span>uniffi<span class="operator">/</span><span class="type">Cargo</span>.toml</span><br><span class="line">warning: unused variable: `e`</span><br><span class="line">  <span class="operator">--&gt;</span> <span class="regexp">/Users/</span>yangcong<span class="regexp">/Documents/</span><span class="type">RustProject</span><span class="regexp">/mobile_rust_demo/</span>mobile<span class="regexp">/src/</span>log.rs:<span class="number">14</span>:<span class="number">19</span></span><br><span class="line">   <span class="operator">|</span></span><br><span class="line"><span class="number">14</span> <span class="operator">|</span>         .map_err(<span class="operator">|</span>e<span class="operator">|</span> anyhow<span class="operator">!</span>(<span class="string">&quot;set logger failed&quot;</span>))<span class="operator">?</span>;</span><br><span class="line">   <span class="operator">|</span>                   <span class="operator">^</span> help: <span class="keyword">if</span> this <span class="keyword">is</span> intentional, <span class="keyword">prefix</span> it with an underscore: `_e`</span><br><span class="line">   <span class="operator">|</span></span><br><span class="line">   <span class="operator">=</span> note: `#[warn(unused_variables)]` on by <span class="keyword">default</span></span><br><span class="line"></span><br><span class="line">warning: `mobile` (lib) generated <span class="number">1</span> warning</span><br><span class="line">    <span class="type">Finished</span> `release` profile [optimized <span class="operator">+</span> debuginfo] target(s) <span class="keyword">in</span> <span class="number">0</span>.12s</span><br><span class="line">    <span class="type">Building</span> arm64<span class="operator">-</span>v8a (aarch64<span class="operator">-</span>linux<span class="operator">-</span>android)</span><br><span class="line">warning: `<span class="regexp">/Users/</span>yangcong<span class="regexp">/.cargo/</span>config` <span class="keyword">is</span> deprecated <span class="keyword">in</span> favor of `config.toml`</span><br><span class="line">note: <span class="keyword">if</span> you need to support cargo <span class="number">1.38</span> or earlier, you can symlink `config` to `config.toml`</span><br><span class="line">warning: `<span class="regexp">/Users/</span>yangcong<span class="regexp">/.cargo/</span>config` <span class="keyword">is</span> deprecated <span class="keyword">in</span> favor of `config.toml`</span><br><span class="line">note: <span class="keyword">if</span> you need to support cargo <span class="number">1.38</span> or earlier, you can symlink `config` to `config.toml`</span><br><span class="line">warning: profiles <span class="keyword">for</span> the non root <span class="keyword">package</span> will be ignored, specify profiles at the workspace root:</span><br><span class="line"><span class="keyword">package</span>:   <span class="regexp">/Users/</span>yangcong<span class="regexp">/Documents/</span><span class="type">RustProject</span><span class="regexp">/mobile_rust_demo/</span>uniffi<span class="regexp">/mobile_ffi/</span><span class="type">Cargo</span>.toml</span><br><span class="line">workspace: <span class="regexp">/Users/</span>yangcong<span class="regexp">/Documents/</span><span class="type">RustProject</span><span class="regexp">/mobile_rust_demo/</span>uniffi<span class="operator">/</span><span class="type">Cargo</span>.toml</span><br><span class="line">warning: unused variable: `e`</span><br><span class="line">  <span class="operator">--&gt;</span> <span class="regexp">/Users/</span>yangcong<span class="regexp">/Documents/</span><span class="type">RustProject</span><span class="regexp">/mobile_rust_demo/</span>mobile<span class="regexp">/src/</span>log.rs:<span class="number">14</span>:<span class="number">19</span></span><br><span class="line">   <span class="operator">|</span></span><br><span class="line"><span class="number">14</span> <span class="operator">|</span>         .map_err(<span class="operator">|</span>e<span class="operator">|</span> anyhow<span class="operator">!</span>(<span class="string">&quot;set logger failed&quot;</span>))<span class="operator">?</span>;</span><br><span class="line">   <span class="operator">|</span>                   <span class="operator">^</span> help: <span class="keyword">if</span> this <span class="keyword">is</span> intentional, <span class="keyword">prefix</span> it with an underscore: `_e`</span><br><span class="line">   <span class="operator">|</span></span><br><span class="line">   <span class="operator">=</span> note: `#[warn(unused_variables)]` on by <span class="keyword">default</span></span><br><span class="line"></span><br><span class="line">warning: `mobile` (lib) generated <span class="number">1</span> warning</span><br><span class="line">    <span class="type">Finished</span> `release` profile [optimized <span class="operator">+</span> debuginfo] target(s) <span class="keyword">in</span> <span class="number">0</span>.05s</span><br><span class="line">warning: `<span class="regexp">/Users/</span>yangcong<span class="regexp">/.cargo/</span>config` <span class="keyword">is</span> deprecated <span class="keyword">in</span> favor of `config.toml`</span><br><span class="line">note: <span class="keyword">if</span> you need to support cargo <span class="number">1.38</span> or earlier, you can symlink `config` to `config.toml`</span><br><span class="line">warning: `<span class="regexp">/Users/</span>yangcong<span class="regexp">/.cargo/</span>config` <span class="keyword">is</span> deprecated <span class="keyword">in</span> favor of `config.toml`</span><br><span class="line">note: <span class="keyword">if</span> you need to support cargo <span class="number">1.38</span> or earlier, you can symlink `config` to `config.toml`</span><br><span class="line">warning: profiles <span class="keyword">for</span> the non root <span class="keyword">package</span> will be ignored, specify profiles at the workspace root:</span><br><span class="line"><span class="keyword">package</span>:   <span class="regexp">/Users/</span>yangcong<span class="regexp">/Documents/</span><span class="type">RustProject</span><span class="regexp">/mobile_rust_demo/</span>uniffi<span class="regexp">/mobile_ffi/</span><span class="type">Cargo</span>.toml</span><br><span class="line">workspace: <span class="regexp">/Users/</span>yangcong<span class="regexp">/Documents/</span><span class="type">RustProject</span><span class="regexp">/mobile_rust_demo/</span>uniffi<span class="operator">/</span><span class="type">Cargo</span>.toml</span><br><span class="line">    <span class="type">Finished</span> `dev` profile [unoptimized <span class="operator">+</span> debuginfo] target(s) <span class="keyword">in</span> <span class="number">0</span>.08s</span><br><span class="line">     <span class="type">Running</span> `target<span class="regexp">/debug/</span>uniffi<span class="operator">-</span>bindgen generate <span class="operator">--</span>library <span class="operator">./</span>target<span class="regexp">/aarch64-linux-android/</span>release<span class="regexp">/libmobile_ffi.so --language kotlin --out-dir ./</span>bindings`</span><br><span class="line"><span class="type">Warning</span>: <span class="type">Unable</span> to auto<span class="operator">-</span>format mobile_ffi.kt using ktlint: <span class="type">Os</span> &#123; code: <span class="number">2</span>, kind: <span class="type">NotFound</span>, message: <span class="string">&quot;No such file or directory&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p> 生成对应的so 文件和kotlin文件</p>
<p><img src="https://tjny2v67lw.feishu.cn/space/api/box/stream/download/asynccode/?code=MGEyN2VjMDg5OTNlZDE1YWQ5ZTAyOWFkNzA1MmM2YzVfOTJHcTJMdTd4YU1EeEhJU0MwSUh2aTJ5TTBOUzVIQ3lfVG9rZW46U01xaWJ1UWt5b2RaeWR4SmxGamNDajFHbmhlXzE3NDIxOTM2OTE6MTc0MjE5NzI5MV9WNA" alt="img"></p>
<h4 id="3-2-4-导入到工程"><a href="#3-2-4-导入到工程" class="headerlink" title="3.2.4  导入到工程"></a>3.2.4  导入到工程</h4><p><img src="https://tjny2v67lw.feishu.cn/space/api/box/stream/download/asynccode/?code=NTc0NDg5YTc4ZjhjZWZiMzViNDNhNGQ5YzRmZTg2YjlfMHVYVk03d1VVZEF5aWQ4R1VDRVdTQ1NndUZhbnZtWnFfVG9rZW46UGpJaWJ1YzRIb3lkVkN4QkhVbmMzbGI2bkpjXzE3NDIxOTM2OTE6MTc0MjE5NzI5MV9WNA" alt="img"></p>
<h4 id="3-2-5-配置"><a href="#3-2-5-配置" class="headerlink" title="3.2.5  配置"></a>3.2.5  配置</h4><ol>
<li>配置 build.grade， 注意一定要是aar格式的。因为rust依赖的是 Java Native Access (JNA), 所以必须是aar的</li>
</ol>
<p><img src="https://tjny2v67lw.feishu.cn/space/api/box/stream/download/asynccode/?code=Y2JjMzIzYWVhYjFlNmY3NjhjZWFjOWRmOWMxZTIyNWVfd1NlQnUxd1Y3d2FlY3pZUktkdkJjWFY4Q1RJS0ZMZEVfVG9rZW46SnF4Y2JlYW5jb0U2aDB4T0Z5aWNGZmQ0bk9nXzE3NDIxOTM2OTE6MTc0MjE5NzI5MV9WNA" alt="img"></p>
<ol>
<li>修改setting.gradle</li>
</ol>
<p><img src="https://tjny2v67lw.feishu.cn/space/api/box/stream/download/asynccode/?code=OWE5ODMwYzIyOTcyMjc1Y2U2N2VhZjA3NTlkYTg5NTVfWGhsQ0RPRGJ5TTRyVlA1bzVmQnZzN2NoZENEbWphNkNfVG9rZW46R1lHNWJtMWJFb0txdnV4YTZoRmNCQ21EbkpkXzE3NDIxOTM2OTE6MTc0MjE5NzI5MV9WNA" alt="img"></p>
<h4 id="3-2-6-调用"><a href="#3-2-6-调用" class="headerlink" title="3.2.6 调用"></a>3.2.6 调用</h4><p><img src="https://tjny2v67lw.feishu.cn/space/api/box/stream/download/asynccode/?code=NjFmMGJjYzI3ZjExOGVlMjk0YTExMzRhZjFhNWEwNmNfS0tKN2dZQUI1dzNjZDdkYUN4QVRZTnJvMlNaRWliRklfVG9rZW46U2xjUmJDSUtsb1BrQ3J4cDBsQ2NEWHpMbmJjXzE3NDIxOTM2OTE6MTc0MjE5NzI5MV9WNA" alt="img"></p>
<h3 id="3-3-Harmony"><a href="#3-3-Harmony" class="headerlink" title="3.3 Harmony"></a>3.3 Harmony</h3><p>参考：<a target="_blank" rel="noopener" href="https://ohos.rs/docs/usage/basic.html">https://ohos.rs/docs/usage/basic.html</a>  </p>
<h4 id="3-3-1-答疑"><a href="#3-3-1-答疑" class="headerlink" title="3.3.1 答疑"></a>3.3.1 答疑</h4><ol>
<li><strong>我们可以直接在鸿蒙上使用原来双端或者其他端已经构建好的动态&#x2F;静态链接库吗？</strong></li>
</ol>
<p>回答：<strong>不可以。</strong></p>
<p>这就好比我们想要在iOS上面运行从安卓的NDK构建出来的动态链接库是一个道理，本身由于环境或者native使用问题或者C&#x2F;C++基础库等一系列问题，导致无法跨系统直接使用。</p>
<h4 id="3-3-2-环境配置"><a href="#3-3-2-环境配置" class="headerlink" title="3.3.2 环境配置"></a>3.3.2 环境配置</h4><ol>
<li>安装ohrs</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo install ohrs</span><br></pre></td></tr></table></figure>

<ol>
<li>安装工具链</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rustup target add aarch64-<span class="built_in">unknown</span>-linux-ohos</span><br><span class="line">rustup target add armv7-<span class="built_in">unknown</span>-linux-ohos</span><br><span class="line">rustup target add x86_64-<span class="built_in">unknown</span>-linux-ohos</span><br></pre></td></tr></table></figure>

<ol>
<li>检查是否安装成功</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ ohrs doctor</span><br><span class="line">✔  <span class="title class_">Environment</span> variable <span class="variable constant_">OHOS_NDK_HOME</span> should be set.</span><br><span class="line">✔  <span class="title class_">Rust</span> version should be &gt;= <span class="number">1.78</span><span class="number">.0</span>.</span><br><span class="line">✔  <span class="title class_">Rustup</span> <span class="attr">target</span>: aarch64-<span class="built_in">unknown</span>-linux-ohos should be installed.</span><br><span class="line">✔  <span class="title class_">Rustup</span> <span class="attr">target</span>: armv7-<span class="built_in">unknown</span>-linux-ohos should be installed.</span><br><span class="line">✔  <span class="title class_">Rustup</span> <span class="attr">target</span>: x86_64-<span class="built_in">unknown</span>-linux-ohos should be installed.</span><br></pre></td></tr></table></figure>

<ol>
<li>配置环境变量</li>
</ol>
<p><img src="https://tjny2v67lw.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmYzMzgzZTQ2ZWVhYzM0ZjRhZWU0YTFmYzQ2MjhhMGFfQ29SdlpkOVNTMkJDdW02UzNIY2FXSE1JV2U1c0RDcXFfVG9rZW46QldTYmIwSWo3b3hBSWt4cHJqUGNmd3NUbnlNXzE3NDIxOTM2OTE6MTc0MjE5NzI5MV9WNA" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export OHOS_NDK_HOME=/Users/yangcong/Library/OpenHarmony/Sdk/12</span><br><span class="line"></span><br><span class="line">export OHOS_NDK_HOME=/Users/swain/Library/OpenHarmony/Sdk/12</span><br></pre></td></tr></table></figure>

<h4 id="3-3-3-编写脚本"><a href="#3-3-3-编写脚本" class="headerlink" title="3.3.3 编写脚本"></a>3.3.3 编写脚本</h4><ul>
<li>思路一：按照Android的集成方式，生成.so 文件，.d.ts文件，自己去实现 cmake, cpp 流程，也能实现，但是工作量很大</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">FFI</span>=<span class="string">&quot;mobile_oh&quot;</span></span><br><span class="line"><span class="variable constant_">OHOS_NDK</span>=<span class="regexp">/Users/y</span>angcong/<span class="title class_">Library</span>/<span class="title class_">OpenHarmony</span>/<span class="title class_">Sdk</span>/<span class="number">12</span></span><br><span class="line"><span class="variable constant_">OHOS_NDK_HOME</span>=$&#123;<span class="variable constant_">OHOS_NDK</span>&#125; ohrs build --dist=./dist/<span class="built_in">symbol</span>/ --release</span><br><span class="line"></span><br><span class="line">cd dist</span><br><span class="line">rm -rf strip</span><br><span class="line">mkdir strip</span><br><span class="line">cp -r <span class="built_in">symbol</span><span class="comment">/* ./strip/</span></span><br><span class="line"><span class="comment">cd -</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># strip so debuginfo</span></span><br><span class="line"><span class="comment">$&#123;OHOS_NDK&#125;/native/llvm/bin/llvm-strip --strip-all ./dist/strip/arm64-v8a/lib$&#123;FFI&#125;.so</span></span><br><span class="line"><span class="comment">$&#123;OHOS_NDK&#125;/native/llvm/bin/llvm-strip --strip-all ./dist/strip/armeabi-v7a/lib$&#123;FFI&#125;.so</span></span><br><span class="line"><span class="comment">$&#123;OHOS_NDK&#125;/native/llvm/bin/llvm-strip --strip-all ./dist/strip/x86_64/lib$&#123;FFI&#125;.so</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tjny2v67lw.feishu.cn/space/api/box/stream/download/asynccode/?code=NjZmMzdlNGYzNTZhZjZkODQ0M2E3MWU1NjRjNmI2NGJfR080czFvZ2Z2WThwTG9jWEhwNG5SdWRCSWNLQjY4cXFfVG9rZW46UWtWaGJpR0g5b2E4OER4ZXhxeGNWMzJZblJnXzE3NDIxOTM2OTE6MTc0MjE5NzI5MV9WNA" alt="img"></p>
<ul>
<li><p>思路二：网上提供了一个新的思路</p>
<ul>
<li><p>使用ohrs 创建工程</p>
</li>
<li><pre><code class="TypeScript"> ohrs init mobile -p=@ohrs/mobile
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 使用ohrs build 和 ohrs artifact 直接生成har包，修改后的脚本如下</span><br><span class="line"></span><br><span class="line">- ```TypeScript</span><br><span class="line">  OHOS_NDK=/Users/yangcong/Library/OpenHarmony/Sdk/12</span><br><span class="line">  OHOS_NDK_HOME=$&#123;OHOS_NDK&#125; ohrs build --release</span><br><span class="line">  </span><br><span class="line">  ohrs artifact </span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
<p>执行脚本，就会生成下面的目录结构 </p>
<p><img src="https://tjny2v67lw.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjQzNWI4NjFlOTYwMmYyMDk3NDIyNjk0OTNlZTQ2YjZfd3dFU2pHdDRIenFJUHpFRlhBbVk5M3BUUFNHVDdrRnlfVG9rZW46TTY5TGJUNGNLb0d1R0V4MUNaTWNaWlFMbno1XzE3NDIxOTM2OTE6MTc0MjE5NzI5MV9WNA" alt="img"></p>
<p>生成的内容很多，但是对我们有用的就是最后的  har 包</p>
<h4 id="3-3-4-工程接入"><a href="#3-3-4-工程接入" class="headerlink" title="3.3.4 工程接入"></a>3.3.4 工程接入</h4><ol>
<li>导入到工程</li>
</ol>
<p><img src="https://tjny2v67lw.feishu.cn/space/api/box/stream/download/asynccode/?code=MTQ3ODc1MTIyZDlkOTI4ZWFlMTJmODc5MTgyYmU4Y2RfdGUyamE4SzA4Z2tyZkF6MDZxdDVnQXNMSE9EVVdDSHRfVG9rZW46UWk0dWJMTTFpb2NhYmV4OTRWbGNiMU9DbnRoXzE3NDIxOTM2OTE6MTc0MjE5NzI5MV9WNA" alt="img"></p>
<ol>
<li>调用</li>
</ol>
<p><img src="https://tjny2v67lw.feishu.cn/space/api/box/stream/download/asynccode/?code=NWY3YWFiMDc1YjM1ODkwZTlkYTgyYzE1NDY0ZjE0MGFfNGZvQVEzTlVXRG1iYTlQOUE2RllSTkdWdGVEWnB2c1RfVG9rZW46RlhuVWJpSm9KbzJJTUV4R1k4b2N1Vkt2bk5oXzE3NDIxOTM2OTE6MTc0MjE5NzI5MV9WNA" alt="img"></p>

  </section>

</article>

<section class="read-more">
           
    
               
            <div class="read-more-item">
                <span class="read-more-item-dim">最近的文章</span>
                <h2 class="post-list__post-title post-title"><a href="/hm-canvas/" title="HarmonyOS - 使用画布绘制自定义图形 (Canvas)">HarmonyOS - 使用画布绘制自定义图形 (Canvas)</a></h2>
                <p class="excerpt">
                
                

Canvas提供画布组件，用于自定义绘制图形，开发者使用CanvasRenderingContext2D对象和OffscreenCanvasRenderingContext2D对象在Canvas组件上进行绘制，绘制对象可以是基础形状、文本、图片等。
使用画布组件绘制自定义图形可以由以下三种形式在
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2024-06-22T10:57:04.000Z" class="post-list__meta--date date">2024-06-22</time> &#8226; <span class="post-list__meta--tags tags">于 
  <a class="-none-link" href="/tags/Canvas/" rel="tag">Canvas</a>, <a class="-none-link" href="/tags/HarmonyOS/" rel="tag">HarmonyOS</a>, <a class="-none-link" href="/tags/%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/" rel="tag">使用教程</a>, <a class="-none-link" href="/tags/%E9%B8%BF%E8%92%99/" rel="tag">鸿蒙</a>
</span><a class="btn-border-small" href="/hm-canvas/">开始阅读</a></div>
                           
            </div>
        
        
               
            <div class="read-more-item">
                <span class="read-more-item-dim">更早的文章</span>
                <h2 class="post-list__post-title post-title"><a href="/hm-event-loop/" title="HarmonyOS - Event Loop事件循环、宏任务and微任务">HarmonyOS - Event Loop事件循环、宏任务and微任务</a></h2>
                <p class="excerpt">
                
                

在阅读本文前先给大家抛出几个问题：

事件循环是什么？
宏任务和微任务是什么？
哪些代码触发宏任务，哪些代码触发微任务？

前言JS是一门单线程语言，单线程就意味着，所有的任务需要排队，前一个任务结束，才会执行下一个任务。
这样所导致的问题是：如果JS执行的时间过长，这样就会造成页面的渲染不连贯
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2024-05-05T08:50:04.000Z" class="post-list__meta--date date">2024-05-05</time> &#8226; <span class="post-list__meta--tags tags">于 
  <a class="-none-link" href="/tags/EventLoop/" rel="tag">EventLoop</a>, <a class="-none-link" href="/tags/HarmonyOS/" rel="tag">HarmonyOS</a>, <a class="-none-link" href="/tags/%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/" rel="tag">原理解析</a>, <a class="-none-link" href="/tags/%E5%AE%8F%E4%BB%BB%E5%8A%A1-%E5%BE%AE%E4%BB%BB%E5%8A%A1/" rel="tag">宏任务/微任务</a>
</span><a class="btn-border-small" href="/hm-event-loop/">开始阅读</a></div>
                       
            </div>
        
     
   
   
  
</section>

  
<section class="post-comments">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      var disqus_shortname = 'warpdrive'; 
      
  var disqus_identifier = '/rust-mob-client/';
  var disqus_title = 'Rust - 移动端跨平台开发实践';
  var disqus_url = 'http://shevakuilin.com/rust-mob-client/';
  

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          //dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
          dsq.src = 'https://a.disquscdn.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a target="_blank" rel="noopener" href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


            <footer class="footer">
    <span class="footer__copyright">
        &copy; 2025 ShevaKuilin - 跃迁引擎 <a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/"> 渝ICP备 19012091</a>, 本站点采用 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>
       
    </span>
    <span class="footer__copyright">
             - 基于 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a> 搭建，使用 <a target="_blank" rel="noopener" href="https://github.com/monniya/hexo-theme-new-vno ">new-vno</a> 主题，由<a target="_blank" rel="noopener" href="https://monniya.com ">@Monniya</a> 修改自 <a href="https://github.com/lenbo-ma/hexo-theme-vno" target="_blank">Vno</a>, 原创出自<a href="http://github.com/onevcat/vno" target="_blank">onevcat</a>
         </span>
       
    
    
</footer>


        </div>
    </div>

     
    


    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    
</body>
</html>
